<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Jul 18, 2013
 | Rendered using Apache Maven Fluido Skin 1.2.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SiteStory  Web Archive - 
   SiteStory  Put protocol  Getting Started Guide</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>

    
    <meta name="Date-Revision-yyyymmdd" content="20130718" />
    <meta http-equiv="Content-Language" content="en" />
    
          <!-- Google Analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-33797706-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://mementoweb.github.com/SiteStory/" id="bannerLeft">
                                                                                                <img src="images/SiteStory_test-1.png"  alt="Transactional Web Archive" width="100" height="100"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://www.mementoweb.org/" id="bannerRight">
                                                                                                <img src="images/mementologo.png"  alt="The Prototyping Team of the Research Library of the Los Alamos National Laboratory" width="100" height="100"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2013-07-18</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.0</li>
                      
                
            
      
                                  
    <li class="pull-right">              <a href="http://www.mementoweb.org/" class="externalLink" title="Memento">Memento</a>
  </li>

        <li class="divider pull-right">|</li>
      
    <li class="pull-right">              <a href="http://httpd.apache.org/docs/2.2/filter.html" class="externalLink" title="Apache Filters">Apache Filters</a>
  </li>

        <li class="divider pull-right">|</li>
      
    <li class="pull-right">              <a href="http://archive-access.sourceforge.net/projects/wayback/administrator_manual.html" class="externalLink" title="Wayback">Wayback</a>
  </li>

        <li class="divider pull-right">|</li>
      
    <li class="pull-right">              <a href="http://addons.mozilla.org/en-US/firefox/addon/mementofox/" class="externalLink" title="MementoFox">MementoFox</a>
  </li>

                        </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                                    <h3>Overview</h3>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Description and Usage">Description and Usage</a>
            </li>
                  <li class="none">
                          <a href="getStarted.html" title="Geting Started">Geting Started</a>
            </li>
                  <li class="none">
                          <a href="redirector.html" title="TimeGate Redirector">TimeGate Redirector</a>
            </li>
                  <li class="none">
            <strong>Put Protocol</strong>
          </li>
                  <li class="none">
                          <a href="testbed.html" title="Testbed">Testbed</a>
            </li>
                  <li class="none">
                          <a href="apidocs/index.html" title="API">API</a>
            </li>
                  <li class="none">
                          <a href="demo.html" title="Demo">Demo</a>
            </li>
                  <li class="none">
                          <a href="http://mementoweb.github.com/SiteStory/repository/gov/lanl/archive/sitestory/1.0/" class="externalLink" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="Acknowledgments.html" title="Acknowledgments">Acknowledgments</a>
            </li>
          </ul>
                        <h3>Project Documentation</h3>
                  <ul>
                                                                                                        <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                      
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section" id="sc_TG">
<h2>Put Protocol <a name="Put_Protocol"></a></h2>
<p>The SiteStory software included the mod_sitestory plugin for the Apache content webserver. It is possible to implement push plug-in to SiteStory from other content servers or from a  custom client in any programming  language. The SiteStory archive has an interface which utilizes the HTTP PUT method to accept the  data related to the client's request to the original server.  The following URL pattern is used to submit the request/response pair :</p>
<div class="source"><pre class="prettyprint">http://[host]:[port]/sitestory/put/[original_url]</pre></div>
<p> The format for the data submited consists of a request line, http_request_headers, an empty line, followed by a status-line of client response, http_response_headers, an empty line and an optional message body. The status-line and headers must all end with  &lt;CR&gt;&lt;LF&gt;  (a carriage return followed by a line feed). The empty line must consist of only  &lt;CR&gt;&lt;LF&gt;   and no other whitespace. While constructing this new PUT request with its own http headers you will need to calculate length of this new compound message body and include  Content-Length header (for ex. Content-Length: 3495) or send PUT request in chunked form (Transfer-Encoding: chunked). Please note, that  URL-M (url of memento)  would be constructed from original http_request_headers using Host header and url portion in the GET request line.    
</p>
<p>
The body of the PUT request to the SiteStory will look like:
</p><div class="source"><pre class="prettyprint">

GET /misc/jquery.js?R HTTP/1.1
User-Agent:Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1)
Referer:http://www.dans.knaw.nl/en/content/geospatial-sciences-data-collection
Accept:*/*
Accept-Language:en-US,nl;q=0.5
Accept-Encoding:gzip, deflate
Connection:keep-alive
Host:www.test.knaw.nl 
X-Client-IP:127.255.255.255

HTTP/1.1 200 OK
Date: Mon, 30 Jul 2009 14:29:09 GMT
Server: Apache
Content-Length:136
Connection: close
Content-Type: text/html; charset=UTF-8

&lt;html&gt;&lt;title&gt;Hello World!&lt;/title&gt;&lt;body&gt;
&lt;p&gt;&lt;font size=\&quot;14\&quot;&gt;Hello World! Page created at  Sun, 30 Jul 2009 &lt;/font&gt;
&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;
 
</pre></div>


<p>As illustration of the general idea, how to push content to the SiteStory, find bellow a client example in java: </p>
<div class="source"><pre class="prettyprint">

....
import org.apache.commons.httpclient.Header;
import org.apache.commons.httpclient.HttpClient;
import org.apache.commons.httpclient.HttpException;
import org.apache.commons.httpclient.methods.GetMethod;
import org.apache.commons.httpclient.methods.PutMethod;
....

public static void test_put() throws HttpException, IOException {
    HttpClient mClient = new HttpClient();
    String bodyonly = &quot;&lt;html&gt;&lt;title&gt;Hello World!&lt;/title&gt;&lt;body&gt;&quot;+
                      &quot;&lt;p&gt;&lt;font size=\&quot;14\&quot;&gt;Hello World! Page created at  Sun, 30 Jul 2009 &lt;/font&gt;&quot;+
                      &quot;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;; 
    int size = bodyonly.length();
    String req_header =&quot;GET /misc/jquery.js?R HTTP/1.1\r\n&quot;+
                       &quot;User-Agent:Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1)\r\n&quot; +
                       &quot;Referer:http://www.dans.knaw.nl/en/content/geospatial-sciences-data-collection\r\n&quot; +
                       &quot;Accept:*/*\r\n&quot;+
                       &quot;Accept-Language:en-US,nl;q=0.5\r\n&quot;+
                       &quot;Accept-Encoding:gzip, deflate\r\n&quot; +
                       &quot;Connection:keep-alive\r\n&quot; +
                       &quot;Host:www.test.knaw.nl\r\n&quot;;

     String res_header =&quot;HTTP/1.1 200 OK\r\nDate: Mon, 30 Jul 2009 14:29:09 GMT\r\nServer: Apache\r\nContent-Length:&quot; + size +
                        &quot;\r\nConnection: close\r\nContent-Type: text/html; charset=UTF-8\r\n&quot;;
     String body=req_header+&quot;\r\n&quot;+res_header+&quot;\r\n&quot;+ bodyonly;
     PutMethod mPut = new PutMethod(&quot;http://www.theresourcedepot.org:8080/SiteStory_Testbed/put/http://www.test.knaw.nl/misc/jquery.js?r&quot;);
               mPut.setRequestBody(body);
               mClient.executeMethod( mPut);
               mPut.releaseConnection();
}
...
 
</pre></div>

<p>After we execute client code above, we can access timegate/memento as follow:</p>
<div class="source"><pre class="prettyprint">

 curl -I http://www.theresourcedepot.org/SiteStory_Testbed/timegate/http://www.test.knaw.nl/misc/jquery.js?r
HTTP/1.1 302 Moved Temporarily
Date: Thu, 13 Jun 2013 19:45:51 GMT
Location: http://www.theresourcedepot.org/SiteStory_Testbed/memento/20090730142909/http://www.test.knaw.nl/misc/jquery.js?r
Vary: negotiate,accept-datetime
Link: &lt;http://www.test.knaw.nl/misc/jquery.js?r&gt;;rel=&quot;original&quot;, &lt;http://www.theresourcedepot.org/SiteStory_Testbed/memento/20090730142909/http://www.test.knaw.nl/misc/jquery.js?r&gt;;rel=&quot;memento first last&quot;; datetime=&quot;Thu, 30 Jul 2009 14:29:09 GMT&quot; , &lt;http://www.theresourcedepot.org/SiteStory_Testbed/timemap/link/http://www.test.knaw.nl/misc/jquery.js?r&gt;;rel=&quot;timemap&quot;; type=&quot;application/link-format&quot;
Connection: close
Content-Type: text/javascript

</pre></div>
<div class="source"><pre class="prettyprint">

curl http://www.theresourcedepot.org/SiteStory_Testbed/memento/20090730142909/http://www.test.knaw.nl/misc/jquery.js?r
&lt;base href=&quot;http://www.test.knaw.nl/misc/jquery.js?r&quot; /&gt;&lt;html&gt;&lt;title&gt;Hello World!&lt;/title&gt;&lt;body&gt;&lt;p&gt;&lt;font size=&quot;14&quot;&gt;Hello World! Page created at  Sun, 30 Jul 2009 &lt;/font&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;

</pre></div>
<p>An optinal <b>X-Client-IP</b> header can be appended to the client  http_request_headers, in this case client ip information will be stored in database.</p>
</div>

                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span16">Copyright &copy;                   2013.
          All Rights Reserved.      
            
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>
