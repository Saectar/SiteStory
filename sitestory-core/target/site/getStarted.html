<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Aug 10, 2012
 | Rendered using Apache Maven Fluido Skin 1.2.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ta-core - 
   ResourceDepot Transactional Web Archive Getting Started Guide</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>

    
    <meta name="Date-Revision-yyyymmdd" content="20120810" />
    <meta http-equiv="Content-Language" content="en" />
    
        </head>
        <body class="topBarEnabled">
          
                
                    
        <div id="topbar" class="navbar navbar-fixed-top">
      <div class="navbar-inner">
                <div class="container-fluid">
                
                              <ul class="nav">
                        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
                  <li>      <a href="index.html"  title="Description and Usage">Description and Usage</a>
</li>
                  <li>      <a href="getStarted.html"  title="Geting Started">Geting Started</a>
</li>
                  <li>      <a href="apidocs/index.html"  title="API">API</a>
</li>
                  <li>      <a href="demo.html"  title="Demo">Demo</a>
</li>
                  <li>      <a href="http://luda171.github.com/twa/repository/gov/lanl/archive/twa/1.0/"  title="Download">Download</a>
</li>
                </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
                  <li>      <a href="project-info.html"  title="Project Information">Project Information</a>
</li>
                  <li>      <a href="project-reports.html"  title="Project Reports">Project Reports</a>
</li>
                </ul>
      </li>
                </ul>
          
          
          
                               <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Links <b class="caret"></b></a>
                <ul class="dropdown-menu">
                      <li>      <a href="http://www.mementoweb.org/"  title="Memento">Memento</a>
</li>
      <li>      <a href="http://httpd.apache.org/docs/2.2/filter.html"  title="Apache Filters">Apache Filters</a>
</li>
      <li>      <a href="http://archive-access.sourceforge.net/projects/wayback/administrator_manual.html"  title="Wayback">Wayback</a>
</li>
      <li>      <a href="http://addons.mozilla.org/en-US/firefox/addon/mementofox/"  title="MementoFox">MementoFox</a>
</li>
      <li>      <a href="http://www.mementoweb.org/tools/validator/"  title="Memento Validator">Memento Validator</a>
</li>
                  </ul>
              </li>
            </ul>
                  </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://luda171.github.com/twa/" id="bannerLeft">
                                                                                                <img src="images/twa_logo2.png"  alt="Transactional Web Archive"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://www.mementoweb.org/" id="bannerRight">
                                                                                                <img src="images/mementologo.png"  alt="The Prototyping Team of the Research Library of the Los Alamos National Laboratory" width="100" height="100"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2012-08-10</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.0</li>
                      
                
            
      
                  </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                                    <h3>Overview</h3>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Description and Usage">Description and Usage</a>
            </li>
                  <li class="none">
            <strong>Geting Started</strong>
          </li>
                  <li class="none">
                          <a href="apidocs/index.html" title="API">API</a>
            </li>
                  <li class="none">
                          <a href="demo.html" title="Demo">Demo</a>
            </li>
                  <li class="none">
                          <a href="http://luda171.github.com/twa/repository/gov/lanl/archive/twa/1.0/" class="externalLink" title="Download">Download</a>
            </li>
          </ul>
                        <h3>Project Documentation</h3>
                  <ul>
                                                                                                        <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                      
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section" id="ch_GettingStarted">
    <h2>Getting Started: Adding Transactional Archiving to your Apache  Web Server. <a name="Getting_Started:_Adding_Transactional_Archiving_to_your_Apache__Web_Server."></a></h2>

    <p>This document contains information to get you started  with &quot;ResourceDepot&quot; our 
     Transactional Web Archive software. It is aimed primarily at developers  and
    contains simple installation instructions of the mod_ta filter extension to your Apache Web Server and  a single ResourceDepot server, and
    few commands to verify that it is running. There are a few sections regarding long term archiving set up involving data distribution between  ResourceDepot and IA Wayback  archives. Finally, as a convenience, for those who want to check it out with minimal effort, a cloud based installation of Resourcedepot is available. The only requirement here is the mod_ta filter to be installed at the Apache Web Server. 
For more information about this option see <a class="externalLink" href="http://www.theresourcedepot.com/overview/"> TheResourceDepot Guide. </a>.</p>

    <div class="section" id="sc_Prerequisites">
        <h3>Prerequisites<a name="Prerequisites"></a></h3>
       <div class="section" id="sc_supportedPlatforms">
        <h4>Supported Platforms<a name="Supported_Platforms"></a></h4>
         <ul>
          <li>
            GNU/Linux is supported as a development and production
              platform for both mod_ta and ResourceDepot.
          </li>
               <li>
                All other platforms have not been tested, but if  required software (see below) runs on your platform, then it is possible that   mod_ta and ResourceDepot will run too.
	 </li>
           </ul>
      </div>
       <div class="section" id="sc_requiredSoftware">
        <h4>Required Software <a name="Required_Software"></a></h4>
          <ul>
       <li>
       mod_ta requires the Apache Web Server, version 2.2 or higher, to be the primary web server that is serving the content to be archived. In addition, Apache Extension Tool (apxs) needs to be installed. <a class="externalLink" href="http://httpd.apache.org/">The Apache website</a> has detailed instructions on how to install both the web server and the extension tool.  
     </li>
       <li>
      ResourceDepot runs in Java, version 1.6  or greater (JDK 6 or greater). It runs as an application under Tomcat 6 or greater. 
       </li>
	 </ul> 
 </div>
    </div>
     <div class="section" id="sc_Download">
      <h3>Download<a name="Download"></a></h3>
      <p>To get the lasted version of the ResourceDepot software, download the stable release
        <a class="externalLink" href="http://luda171.github.com/twa/repository/gov/lanl/archive/twa/1.0/">
          here</a>. For the mod_ta.c see <a class="externalLink" href="http://github.com/Luda171/twa">source repository</a></p>
       </div>

        <div class="section" id="sc_InstallingMod_ta">
        <h3>Installation of mod_ta<a name="Installation_of_mod_ta"></a></h3>
       <p>  Pushing data from your Apache Web Server to the ResourceDepot is done by installing a special filter to  Apache which we call mod_ta.  
	More information on Apache filters and mod_ta can be found <a href="mod_ta.xhtml"> here.</a> The hands on example of the  mod_ta.c installation can be found here: for  <a href="How_to_install_mod_ta_on_Fedora_Core_Linux.xhtml">  Fedora Core </a> and <a href="ubuntu_mod_ta.xhtml">Ubuntu</a> Linux.
  Installation of  the mod_ta filter consists of executing of  the following command:<b>sudo /usr/sbin/apxs -c -i &#x2013;a mod_ta.c </b>  and editing the Apache configuration file.  Add the following lines to the Apache configuration file: </p>
<div class="source"><pre class="prettyprint"> &lt;IfModule ta_module&gt;
    EnableArchiving On
    ArchiveHost www.myarchivename.com
    ArchivePort 8080
    ArchivePath /[appname]/put/
    ArchiveTimeGate http://www.myarchivename.com/[appname]/timegate/
    EnableIP On  
    Excluded /search /test 
 &lt;IfModule&gt;

</pre></div>
        <p> Here are the meanings                                                                                                                    
      for each of the fields:       
       </p>

 <dl>
 
          <dt><b>EnableArchiving</b></dt>

          <dd>
            On/Off toggles transactional archiving on or off.   
          </dd>
 

        
          <dt><b>ArchiveHost</b></dt>

          <dd>
            the host name of the transactional archive.  
          </dd>
        
         
          <dt><b>ArchivePort</b></dt>

          <dd>
            the port number of the transactional archive.  
          </dd>
	 
            
          <dt><b>ArchivePath</b></dt>
          <dd>
             the path to the put interface of the archive, since the put interface of the transactional archive is constructed as http://[archivehost]:[port]/[appname]/put .  
          </dd>
	    
           
          <dt><b>ArchiveTimeGate</b></dt>
          <dd>
             the baseURL of the Memento TimeGate service at archive. 
          </dd>
            

          
          <dt><b>EnableIP</b></dt>

          <dd>
             On/Off enables or disables recording of the client&#x2019;s request IP address   
          </dd>
	  
            
          <dt><b>Excluded</b></dt>
          <dd>
             list of directories excluded from archiving (optional parameter). For example, if you want to exclude http://mycontenthost/search from archiving, specify /search as  Excluded. All content of the listed directories, including their child directories, will be excluded.  
          </dd>
	    
          </dl>
<p>Please note, that only HTTP GET requests are archived with Response codes 200,302,303 </p>
	</div>
           <div class="section" id="sc_InstallingUnderTomcat">
            <h3>Installation of ResourceDepot under Tomcat <a name="Installation_of_ResourceDepot_under_Tomcat"></a></h3>
            <p>
                  Setting up a ResourceDepot server under Tomcat is
                  straightforward. The server is contained in a single WAR file named 'twa.war'. The
installation therefore only consists of editing a configuration file. You can rename the twa.war to your  [appname].war if you want. 
             </p>
            <p>
                 Once you copied the WAR file into the [TOMCAT-HOME]/webapps directory, you can find the ta.properties file
                 in the [TOMCAT-HOME]/webapps/twa/WEB-INF/classes directory.  </p>
<div class="source"><pre class="prettyprint">                 
#rest.min.grizzly.threads=7
#rest.max.grizzly.threads=128
#warcfiles.unload.dir=/storage/twa/db/warcfiles
#ta.warcwriterpool.maxwait=20000
#ta.warcwriterpool.maxactive=3
ta.index=gov.lanl.archive.index.bdb.IndexImplB
ta.storage.basedir=/storage/twa/db
#ta.index.basedir=/storage/twa/db/bdbindex
#put.ip.1=127.0.0.1
#put.ip.2=192.12.184.6
</pre></div>
            <p>
             Change the
      value of the  <b>ta.storage.basedir</b> to specify an
      existing (empty to start with) directory. All commented out parameters  are optional.   Here are the meanings
      for each of the fields:</p>
                 <dl>
        
          <dt><b>ta.storage.basedir</b></dt>

          <dd>
            This is the directory for the storage of HTTP response stream files. By default Berkeley DB indexes will be created here as well unless <b> ta.index.basedir </b> is  specified. Make sure that Tomcat has permissions to create directories in this directory.   
          </dd>
        
		 </dl>
      <dl>
        
          <dt><b>ta.index.basedir</b></dt>

          <dd>
            The location to store Berkeley DB indexes, which contain the transaction log of every page access of the content Apache server.
          </dd>
        
            
          <dt><b>warcfiles.unload.dir</b></dt>

          <dd>
            The directory to unload data in WARC format to migrate to the Wayback archive. 
          </dd>
	    
          
          <dt><b>put.ip.1</b></dt>

          <dd>
            IP address of the Apache  content server, to restrict any other servers to put content to your archive. List of IPs can be specified if needed.  
          </dd>
          
           
          <dt><b>ta.index</b></dt>

          <dd>
            Class file of implementation of index store. Currently only one implementation exist based on Berkeley DB. 
          </dd>
	   
          
             <dt><b>ta.warcwriterpool.maxactive</b></dt>

          <dd>
            Parameter for WarcWriter of InternetArchive. Specify how many parallel WARCWriters to run.  
          </dd>
      
          
             <dt><b>ta.warcwriterpool.maxwait</b></dt>

          <dd>
            Parameter for WarcWriter of InternetArchive. Specify how long to wait on  WARCWriter from the pool  of  WARCWriters  
          </dd>
	  
           
             <dt><b>rest.min.grizzly.threads</b></dt>

          <dd>
            Minimum number of threads  for standalone installation as grizzly server. Not used under Tomcat installation
          </dd>
     
              
             <dt><b>rest.max.grizzly.threads</b></dt>

          <dd>
            Maximum number of threads  for standalone installation as grizzly server. Not used under Tomcat installation
          </dd>
	      
       </dl>
        <p> These changes require a reboot of the Tomcat server. You can access any page of your content Apache server and look into the ResourceDepot Tomcat logs to check if the PUT service is working. Also, you can check that the directories structure has been created at <b> ta.storage.basedir </b>.</p>
<div class="source"><pre class="prettyprint">                                                                                                                                                                          
[user@host ta]$ pwd                                                                                                                                                                       
/storage/ta/db                                                                                                                                                                  
[user@host db]$ ls                                                                                                                                                                    
bdbindex  storage                                                                                                                                                                         
[user@host db]$ cd bdbindex                                                                                                                                                           
[user@host bdbindex]$ ls                                                                                                                                                                  
00000005.jdb  00000006.jdb  je.info.0  je.info.0.1  je.info.0.lck  je.lck  je.properties                                                                                                  
[user@host bdbindex]$ cd /storage/ta/db/storage                                                                                                                                 
[user@host storage]$ ls                                                                                                                                                                   
00  06  0c  12  18  1e  24  2a  30  36  3c  42  48  4e  54  5a  60  66  6c  72  78  7e  84  8a  90  96  9c  a2  a8  ae  b4  ba  c0  c6  cc  d2  d8  de  e4  ea  f0  f6  fc                
01  07  0d  13  19  1f  25  2b  31  37  3d  43  49  4f  55  5b  61  67  6d  73  79  7f  85  8b  91  97  9d  a3  a9  af  b5  bb  c1  c7  cd  d3  d9  df  e5  eb  f1  f7  fd                
02  08  0e  14  1a  20  26  2c  32  38  3e  44  4a  50  56  5c  62  68  6e  74  7a  80  86  8c  92  98  9e  a4  aa  b0  b6  bc  c2  c8  ce  d4  da  e0  e6  ec  f2  f8  fe                
03  09  0f  15  1b  21  27  2d  33  39  3f  45  4b  51  57  5d  63  69  6f  75  7b  81  87  8d  93  99  9f  a5  ab  b1  b7  bd  c3  c9  cf  d5  db  e1  e7  ed  f3  f9  ff                
04  0a  10  16  1c  22  28  2e  34  3a  40  46  4c  52  58  5e  64  6a  70  76  7c  82  88  8e  94  9a  a0  a6  ac  b2  b8  be  c4  ca  d0  d6  dc  e2  e8  ee  f4  fa                    
05  0b  11  17  1d  23  29  2f  35  3b  41  47  4d  53  59  5f  65  6b  71  77  7d  83  89  8f  95  9b  a1  a7  ad  b3  b9  bf  c5  cb  d1  d7  dd  e3  e9  ef  f5  fb                    
[user@host storage]$ cd 00                                                                                                                                                                
[user@host 00]$ ls                                                                                                                                                                        
01  0c  12  17  1d  25  2d  35  42  49  51  58  5e  62  66  74  7a  84  88  8c  91  98  9e  a2  ad  b1  b7  be  c3  c9  cf  d3  d8  e2  e7  f0  f9                                        
04  0d  13  1a  1e  26  30  37  45  4c  53  5b  5f  64  67  75  7e  85  8a  8d  95  9a  a0  a9  ae  b4  ba  c1  c4  ca  d1  d5  dc  e4  e9  f2  fa                                        
05  0e  14  1c  21  2b  31  3b  48  4f  57  5c  60  65  69  76  81  87  8b  8f  97  9d  a1  aa  af  b5  bc  c2  c7  ce  d2  d7  e1  e5  ed  f3  fc                                        
[user@host]$ cd 01                                                                                                                                                                        
[user@host]$ ls                                                                                                                                                                           
3da4-350d-4896-8fa8-9772c63a914d.body                                                                                                                                                     
</pre></div>

          </div>
 <div class="section" id="Sc_Memnto">
       <h3>Memento Interface to ResourceDepot<a name="Memento_Interface_to_ResourceDepot"></a></h3>
  <p> ResourceDepot provides REST - style services to access and manage content. 
  To let Memento clients  access archived content from ResourceDepot, 
  the following services are provided.    Please refer to the <a class="externalLink" href="http://mementoweb.org">Memento protocol</a> for additional information.</p>
 <dl>
 
 <dt><b>TimeGate</b></dt>
 <dd>To access the TimeGate from ResourceDepot (installed as twa.war) for the resource with URI [original_url] that is served by the Content Server:
     <div class="source"><pre class="prettyprint">curl -D headers.txt -H Accept-Datetime:'Wed, 29 Sep 2008 12:00:04 GMT&#x2019; \
http://[host]:[port]/twa/timegate/[original_url] 
     </pre></div>
 </dd>
 
 
 <dt><b>Memento</b></dt>

  <dd> To retrieve a Memento (archived version of a resource) from Resourcedepot 
                                                for the resource with URI [original_url] that is served by the Content Server: 

                                                        
 <div class="source"><pre class="prettyprint">curl -D headers.txt \
http://[host]:[port]/twa/memento/20110311000508/[original_url] </pre></div>   
In this URI, 20110311000508 represents the archival date/time of the resource with the URI [original_url] expressed in the form YYYYMMDDHHMMSS.

  </dd>
 
  
 <dt><b>TimeMap</b></dt>
 <dd>To retrieve a <a class="externalLink" href="http://www.mementoweb.org/guide/rfc/ID/#timemap">link-value formatted</a>
 TimeMap from ResourceDepot for the resource with URI [original_url] that is served by the Content Server: 
                                                        
 <div class="source"><pre class="prettyprint">curl \
http://[host]:[port]/twa/timemap/link/[original_url]
</pre></div>
</dd>

 
 <dt><b>TimeBundle</b></dt>
 <dd>To retrieve the TimeBundle of a resource: 
 <div class="source"><pre class="prettyprint">curl  -H Accept:&#x201d;application/rdf+xml&#x201d; \
http://[host]:[port]/twa/timebundle/[original_url]
 </pre></div>
 </dd>
 
</dl>
</div>
<div class="section" id="sc_unloadWARC">
<h3> Exporting and Deleting services of ResourceDepot<a name="Exporting_and_Deleting_services_of_ResourceDepot"></a></h3>
<p>  The ResourceDepot provides a service to unload HTTP request/response data to <a class="externalLink" href="http://archive-access.sourceforge.net/warc/warc_file_format-0.16.html"> WARC file format</a>. This procedure can be a long-term data managing tool to offload data to Wayback archives. 
</p> 
<dl>
 
 <dt><b>WARCUnload</b></dt>
<dd>
 <div class="source"><pre class="prettyprint">curl \
http://[archivehost]:[port]/twa/warcunload/20120329000508/* </pre></div> 
The archived data before the 20120329000508 date will be recoded to the wayback files at the directory, specified by <b>warcfiles.unload.dir</b> in ta.properties. We decided to omit the recording of revisit (by digest) records to WARC files to avoid stress to  the Wayback. To compensate, we  added special metadata records  with information on time interval  where the recorded response body bitstream was the same, based on digest calculation  over bitstream as well as number of page hits during that period, see a sample of WARC file <a href="warcfile_example.html"> here</a> .
</dd>
 

 <dt><b>Delete</b></dt>
<dd>
 <div class="source"><pre class="prettyprint">curl \
http://[archivehost]:[port]/twa/delete/20120410000508/*
 </pre></div>

The archived data before the 20120329000508 date will be deleted from ResourceDepot.

 <div class="source"><pre class="prettyprint">curl \
http://[archivehost]:[port]/twa/delete/20120410000508/http://myhost/test
 </pre></div>
                                                                                                                                                                                The archived data with url=&quot;http://myhost/test&quot;  before the 20120329000508 date will be deleted from ResourceDepot.                                                                       
<div class="source"><pre class="prettyprint">curl \
http://[archivehost]:[port]/twa/delete/*/http://myhost/test
</pre></div>
                                                                                                                                                               
The archived data with url=&quot;http://myhost/test&quot;   will be deleted from ResourceDepot.                                                                    

</dd>


</dl>

</div>

 <div class="section" id="sc_TG">
<h3>TimegateDirector Interface<a name="TimegateDirector_Interface"></a></h3>
<p>                                                                                                                                                                                 Long-term deployment of a transactional archive will require a more complex distributed set-up. 
 For example, several ResourceDepot archives can be created on different machines.  Older data can be unloaded from ResourceDepot to the WARC file format and deployed as <a class="externalLink" href="http://archive-access.sourceforge.net/projects/wayback/downloads.html"> Wayback archive</a> and old data can be purged from the ResourceDepot instance. The WARC format provides more compact storage in relation to  total number of files in the file system. For the web servers  with very dynamic pages,  total number of files in ResourceDepot vs inode disk parameter can be an important indicator of the need to offload data to a Wayback archive or start a new ResourceDepot archive at a new disk. The archiving set up involving data distribution between  ResourceDepot and IA Wayback  archives is demonstrated here. Please note, that Wayback software supports the Memento interface, see <a href="wayback_memento.html"> Wayback Memento install how-to</a>.</p> <p> To make a Memento client work seamlessly with multiple archives, TimegateDirector   interface is provided. TimegateDirector dispatches a Memento client to the correct timegate,  depending on the date requested in the  Accept-datetime link header.</p>
  <p> <p>Setting up a TimegateDirector server under Tomcat is straightforward. The server is contained in a single WAR file named &quot;tg-redirector.war&quot;. The installation therefore only consists of  editing  a configuration file. Ones you copied the WAR file into the [TOMCAT-HOME]/webapps directory, you can find the timegates.xml file   in [TOMCAT-HOME]/webapps/tg-redirector/WEB-INF/classes directory. Restart Tomcat after editing the timegates.xml file.  </p>
From the example below we can see that archived data is distributed between  wayback archive ( timegate:http://lanlproto.santafe.edu:8080/memento/timegate/) and ResourceDepot (timegate : http://www.theresourcedepot.com/000010/timegate/).
</p>
<div class="source"><pre class="prettyprint">

&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;timegates&gt;
          &lt;timegate uri=&quot;http://lanlproto.santafe.edu:8080/memento/timegate/&quot;&gt;
          &lt;start&gt;Tue\, 27 Mar 2012 22:08:10 GMT&lt;/start&gt;
          &lt;end&gt;Mon\, 09 Apr 2012 23:35:02 GMT&lt;/end&gt;
          &lt;timemap uri=&quot;http://lanlproto.santafe.edu:8080/memento/timemap/link/&quot; /&gt;
          &lt;/timegate&gt;
          &lt;timegate uri=&quot;http://www.theresourcedepot.com/000010/timegate/&quot;&gt;
          &lt;start&gt;Mon\, 09 Apr 2012 23:35:03 GMT&lt;/start&gt;
          &lt;end&gt;Tue\, 19 Apr 2031 12:00:02 GMT&lt;/end&gt;
          &lt;timemap uri=&quot;http://www.theresourcedepot.com/000010/timemap/link/&quot; /&gt;
          &lt;/timegate&gt;
&lt;/timegates&gt;

</pre></div>
<p>IF you have multiple archives installed with TimegateDirector, you also will need to change the Timegate Link Header at your Content Apache server mod_ta module config section.
For example, if TimegateDirector is installed at http://www.theresourcedepot.com/000010D (war file was renamed as 000010D.war), then the <b>ArchiveTimeGate </b> parameter  needs to point to that URL.<br></br> Example output from TimegateDirector: </p>
<div class="source"><pre class="prettyprint">
curl -D my.txt -I  -H &quot;Accept-datetime: Sun, 25 June 2010 12:00:00 GMT&quot; \
http://theresourcedepot.org/000010D/http://www.dans.knaw.nl
HTTP/1.1 302 Moved Temporarily
Date: Wed, 30 May 2012 18:46:13 GMT
Location: http://lanlproto.santafe.edu:8080/memento/timegate/http://www.dans.knaw.nl
Link: &lt;http://theresourcedepot.org/000010D/timemap/http://www.dans.knaw.nl&gt;;rel=&quot;timemap index&quot;; type=&quot;application/link-format&quot;
Connection: close
Content-Type: text/plain; charset=UTF-8
Content-Language: nl

</pre></div>
<p>To facilitate  discovery of multiple archives by clients we also provide timemap index service with this application.  Example output from index timemap service:  </p>
<div class="source"><pre class="prettyprint">

curl \
 http://theresourcedepot.org/000010D/timemap/http://www.dans.knaw.nl
&lt;http://www.dans.knaw.nl&gt;;rel=&quot;original&quot; ,
 &lt;http://theresourcedepot.org/000010D/timemap/http://www.dans.knaw.nl&gt;;rel=&quot;self timemap&quot;; type=&quot;application/link-format&quot;, 
 &lt;http://lanlproto.santafe.edu:8080/list/timemap/link/http://www.dans.knaw.nl&gt;;rel=&quot;timemap first&quot;; type=&quot;application/link-format&quot;,
 &lt;http://www.theresourcedepot.com/000010/timemap/link/http://www.dans.knaw.nl&gt;;rel=&quot;timemap last&quot;; type=&quot;application/link-format&quot;

</pre></div>
<p>The index timemap is constructed from the timemap entries of the timegates.xml config file.   </p>
 </div>
<div class="section" id="sc_optimization">
<h3>Optimization<a name="Optimization"></a></h3>
<dl>
 
 <dt><b>connectionTimeout of Tomcat</b></dt>
 <dd>If your Apache Content server contains some pages which require a long time to load,                                                                                    we recommend to change Tomcat's connectionTimeout parameter in the server.xml to a larger value, for example 
     <div class="source"><pre class="prettyprint">
        &lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;
               connectionTimeout=&quot;60000&quot; maxKeepAliveRequests=&quot;15&quot; maxThreads=&quot;300&quot;
               redirectPort=&quot;8443&quot; /&gt;  
       
     </pre></div>
 A  value too low  for the timeout parameter may  effect the completion of  the HTTP PUT requests to the ResourceDepot (used by mod_ta filter)  
 </dd>

 

 <dt><b>je.properties</b></dt>
 <dd> 
 Copy je.properties to your db indexdir: ../bdbindex.
 You can add the following parameters: 
<div class="source"><pre class="prettyprint">
 je.log.fileMax=500000000 //You can alter size of the db file (default is 10M) to have more compact storage.
 je.evictor.useMemoryFloor=65 //You can tune memory parameters
 je.maxMemory=120000000
 je.env.runCleaner=true //set to clean logs periodically
 je.env.runEvictor=true
 je.env.recovery=true
 je.env.sharedLatches=false 
</pre></div>
 

 </dd>


 
</dl>
</div>
</div>
      
                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span16">Copyright &copy;                    2012
                        <a href="http://library.lanl.gov/">Los Alamos National Security, LLC, Research Library Proto Team</a>.
            All Rights Reserved.      
            
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>
